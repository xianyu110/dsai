<!DOCTYPE html>
<html lang="zh-CN" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🤖 AI交易机器人控制台</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' style='stop-color:%2367eaca;stop-opacity:1'/><stop offset='100%25' style='stop-color:%233b82f6;stop-opacity:1'/></linearGradient></defs><circle cx='50' cy='50' r='45' fill='url(%23grad)'/><path d='M 35 40 Q 35 35 40 35 L 45 35 Q 50 35 50 40 L 50 50 Q 50 55 45 55 L 40 55 Q 35 55 35 50 Z M 50 40 Q 50 35 55 35 L 60 35 Q 65 35 65 40 L 65 50 Q 65 55 60 55 L 55 55 Q 50 55 50 50 Z M 30 65 Q 40 70 50 70 Q 60 70 70 65' fill='none' stroke='white' stroke-width='3' stroke-linecap='round'/></svg>">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <!-- 主题切换按钮 -->
    <button class="theme-toggle" onclick="toggleTheme()" title="切换主题">
        <span class="theme-icon">🌙</span>
    </button>

    <div class="container">
        <header>
            <div class="header-top">
                <h1>🤖 AI交易机器人控制台</h1>
                <div class="header-actions">
                    <button class="config-btn" onclick="openConfigModal()" title="环境配置">
                        ⚙️ 配置
                    </button>
                    <button class="logout-btn" onclick="logout()" title="登出">
                        🚪 登出
                    </button>
                    <span class="connection-status">
                        <span class="pulse"></span>
                        已连接
                    </span>
                </div>
            </div>
            <div class="status-bar" id="statusBar">
                <span>余额: <strong id="balance">-</strong> USDT</span>
                <span>总盈亏: <strong id="totalPnl" class="pnl">-</strong> USDT</span>
                <span>更新: <span id="updateTime">-</span></span>
            </div>
        </header>

        <!-- 策略管理区域 -->
        <section class="strategy-section">
            <div class="section-header">
                <h2>🤖 AI策略管理</h2>
                <div class="strategy-controls">
                    <select id="strategySelect" class="strategy-select">
                        <option value="">选择策略...</option>
                    </select>
                    <button class="action-btn success" onclick="startSelectedStrategy()" id="startStrategyBtn">
                        ▶️ 启动
                    </button>
                    <button class="action-btn danger" onclick="stopSelectedStrategy()" id="stopStrategyBtn">
                        ⏹️ 停止
                    </button>
                    <button class="action-btn" onclick="refreshStrategies()">🔄 刷新</button>
                </div>
            </div>
            <div class="strategy-info" id="strategyInfo" style="display: none;">
                <div style="text-align: center; padding: 40px; color: #94a3b8;">
                    请选择一个策略
                </div>
            </div>
        </section>

        <section class="controls-section">
            <h2>🎮 手动操作</h2>
            <div class="manual-controls">
                <div class="manual-trade">
                    <h3>交易操作</h3>
                    <select id="tradeSymbol">
                        <option value="BTC/USDT">BTC/USDT</option>
                        <option value="ETH/USDT">ETH/USDT</option>
                        <option value="SOL/USDT">SOL/USDT</option>
                        <option value="DOGE/USDT">DOGE/USDT</option>
                        <option value="BNB/USDT">BNB/USDT</option>
                    </select>
                    <div class="input-group">
                        <input type="number" id="tradeAmount" placeholder="输入金额" value="200" min="1" step="1">
                        <span class="input-suffix">USDT</span>
                    </div>
                    <select id="tradeLeverage">
                        <option value="3">3倍杠杆 (保守)</option>
                        <option value="5" selected>5倍杠杆 (平衡)</option>
                        <option value="10">10倍杠杆 (激进)</option>
                        <option value="20">20倍杠杆 (极限)</option>
                    </select>
                    <div class="trade-info" id="tradeInfo">
                        预计开仓: <span id="estimatedContracts">-</span> 张
                    </div>
                    <button onclick="executeTrade('buy')" class="btn btn-long">开多</button>
                    <button onclick="executeTrade('sell')" class="btn btn-short">开空</button>
                    <button onclick="executeTrade('close')" class="btn btn-close">平仓</button>
                </div>
                <div class="manual-analysis">
                    <h3>AI分析</h3>
                    <select id="analysisSymbol">
                        <option value="BTC/USDT">BTC/USDT</option>
                        <option value="ETH/USDT">ETH/USDT</option>
                        <option value="SOL/USDT">SOL/USDT</option>
                        <option value="DOGE/USDT">DOGE/USDT</option>
                        <option value="BNB/USDT">BNB/USDT</option>
                    </select>
                    <button onclick="triggerAnalysis()" class="btn btn-analysis" id="analysisBtn">
                        🧠 触发AI分析
                    </button>
                    <button onclick="triggerAllAnalysis()" class="btn btn-all-analysis">
                        🔄 分析所有币种
                    </button>
                </div>
            </div>
        </section>

        <section class="trade-logs-section">
            <div class="section-header">
                <h2>📋 交易操作日志</h2>
                <button class="action-btn" onclick="refreshTradeLogs()">
                    🔄 刷新
                </button>
            </div>
            <div class="trade-logs-container" id="tradeLogsContainer">
                <div style="text-align: center; padding: 40px; color: #94a3b8;">
                    暂无操作日志
                </div>
            </div>
        </section>

        <section class="unified-trading-section">
            <div class="section-header">
                <h2>📋 合约持仓</h2>
                <div class="section-actions">
                    <button class="action-btn" onclick="refreshOrders()">
                        🔄 刷新
                    </button>
                    <button class="action-btn-subtle danger" onclick="closeAllPositions()">
                        ⚠️ 一键平仓
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table class="orders-table">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="selectAll" onclick="toggleSelectAll()"></th>
                            <th>🆔 ID</th>
                            <th>📊 合约品种</th>
                            <th>🎯 方向</th>
                            <th>📏 数量</th>
                            <th>💵 开仓价</th>
                            <th>💰 当前价</th>
                            <th>💎 保证金</th>
                            <th>⚡ 强平价</th>
                            <th>📈 盈亏(USDT)</th>
                            <th>📊 24h涨跌</th>
                            <th>📍 状态</th>
                            <th>⚠️ 平仓</th>
                        </tr>
                    </thead>
                    <tbody id="ordersTableBody">
                        <tr>
                            <td colspan="13" style="text-align: center; padding: 40px; color: #94a3b8;">
                                暂无持仓数据
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <div class="positions-container">
            
            <section class="spot-section">
                <div class="section-header">
                    <h2>💰 现货余额</h2>
                    <button class="collapse-btn" onclick="toggleSpotBalance()">
                        <span id="spotToggleIcon">▼</span>
                    </button>
                </div>
                <div id="spotGrid" class="grid"></div>
            </section>
        </div>
    </div>

    <!-- 配置弹窗 -->
    <div id="configModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>⚙️ 环境配置</h2>
                <button class="modal-close" onclick="closeConfigModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="config-tabs">
                    <button class="config-tab active" onclick="switchConfigTab('exchange')">交易所</button>
                    <button class="config-tab" onclick="switchConfigTab('ai')">AI</button>
                    <button class="config-tab" onclick="switchConfigTab('proxy')">网络</button>
                    <button class="config-tab" onclick="switchConfigTab('trade')">交易参数</button>
                </div>

                <div id="exchangeConfig" class="config-panel active">
                    <h3>交易所配置</h3>
                    <div class="form-group">
                        <label>交易所类型</label>
                        <select id="exchangeType">
                            <option value="okx">OKX (推荐)</option>
                            <option value="binance">Binance</option>
                        </select>
                    </div>

                    <h4>OKX 配置</h4>
                    <div class="form-group">
                        <label>API Key</label>
                        <input type="text" id="okxApiKey" placeholder="请输入 OKX API Key">
                    </div>
                    <div class="form-group">
                        <label>Secret</label>
                        <input type="password" id="okxSecret" placeholder="请输入 OKX Secret">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="okxPassword" placeholder="请输入 OKX Password">
                    </div>

                    <h4>Binance 配置</h4>
                    <div class="form-group">
                        <label>API Key</label>
                        <input type="text" id="binanceApiKey" placeholder="请输入 Binance API Key">
                    </div>
                    <div class="form-group">
                        <label>Secret</label>
                        <input type="password" id="binanceSecret" placeholder="请输入 Binance Secret">
                    </div>
                </div>

                <div id="aiConfig" class="config-panel">
                    <h3>AI 配置</h3>
                    <div class="form-group">
                        <label>AI 模型</label>
                        <select id="aiModel">
                            <option value="deepseek">DeepSeek (推荐)</option>
                            <option value="grok">Grok (xAI)</option>
                            <option value="claude">Claude (Anthropic)</option>
                        </select>
                    </div>

                    <h4>中转 API 配置</h4>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="useRelayApi" style="width: auto; margin: 0;">
                            使用中转 API（性价比更高）
                        </label>
                        <small>中转API可以降低成本，提供更稳定的服务</small>
                    </div>
                    <div class="form-group">
                        <label>中转 API 地址</label>
                        <input type="text" id="relayApiBaseUrl" placeholder="例如: https://api.example.com/v1">
                    </div>
                    <div class="form-group">
                        <label>中转 API Key</label>
                        <input type="password" id="relayApiKey" placeholder="请输入中转 API Key">
                    </div>

                    <h4>官方 API 配置</h4>
                    <div class="form-group">
                        <label>DeepSeek API Key</label>
                        <input type="password" id="deepseekApiKey" placeholder="请输入官方 DeepSeek API Key">
                        <small>不使用中转API时需要</small>
                    </div>
                    <div class="form-group">
                        <label>Grok API Key</label>
                        <input type="password" id="grokApiKey" placeholder="请输入 Grok API Key">
                    </div>
                    <div class="form-group">
                        <label>Claude API Key</label>
                        <input type="password" id="claudeApiKey" placeholder="请输入 Claude API Key">
                    </div>
                </div>

                <div id="proxyConfig" class="config-panel">
                    <h3>网络代理配置</h3>
                    <div class="form-group">
                        <label>HTTP Proxy</label>
                        <input type="text" id="httpProxy" placeholder="例如: http://127.0.0.1:7890">
                        <small>用于访问交易所和AI服务（可选）</small>
                    </div>
                    <div class="form-group">
                        <label>HTTPS Proxy</label>
                        <input type="text" id="httpsProxy" placeholder="例如: http://127.0.0.1:7890">
                        <small>留空则使用 HTTP Proxy 设置</small>
                    </div>
                </div>

                <div id="tradeConfig" class="config-panel">
                    <h3>交易参数配置</h3>
                    <div class="form-group">
                        <label>交易币种（逗号分隔）</label>
                        <input type="text" id="symbols" placeholder="例如: BTC/USDT,ETH/USDT">
                    </div>
                    <div class="form-group">
                        <label>默认交易金额 (USDT)</label>
                        <input type="number" id="amountUsd" placeholder="100" min="1">
                    </div>
                    <div class="form-group">
                        <label>默认杠杆倍数</label>
                        <select id="leverage">
                            <option value="3">3倍（保守）</option>
                            <option value="5">5倍（平衡）</option>
                            <option value="10">10倍（激进）</option>
                            <option value="20">20倍（极限）</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeConfigModal()">取消</button>
                <button class="btn btn-primary" onclick="saveConfig()">保存配置</button>
            </div>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html>
